
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Deploying your node app with Docker</title>
    <meta name="description" content="">

    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="../favicon.ico">

    <link rel="stylesheet" type="text/css" href="../assets/css/screen.css?v=ec6d317db7">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic%7COpen+Sans:700,400">

    <link rel="canonical" href="index.html">
    <meta name="referrer" content="origin">
    
    <meta property="og:site_name" content="">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Deploying your node app with Docker">
    <meta property="og:description" content="Setting up your Docker image locally Download/Install Docker Tools https://www.docker.com/docker-toolbox Boot docker machine Run Docker Quickstart Terminal This will start up a docker-machine (virtual machine) on your local computer Once the docker machine is running,...">
    <meta property="og:url" content="http://localhost:2368/deploying-your-node-app-with-docker/">
    <meta property="article:published_time" content="2015-11-16T23:22:34.344Z">
    <meta property="article:modified_time" content="2015-11-16T23:29:44.370Z">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Deploying your node app with Docker">
    <meta name="twitter:description" content="Setting up your Docker image locally Download/Install Docker Tools https://www.docker.com/docker-toolbox Boot docker machine Run Docker Quickstart Terminal This will start up a docker-machine (virtual machine) on your local computer Once the docker machine is running,...">
    <meta name="twitter:url" content="http://localhost:2368/deploying-your-node-app-with-docker/">
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "",
    "author": {
        "@type": "Person",
        "name": "nick fujita",
        "image": "http://localhost:2368/content/images/2015/10/nickFujitaGenericProfilePic.jpg",
        "url": "http://localhost:2368/author/nickfujita",
        "sameAs": null,
        "description": null
    },
    "headline": "Deploying your node app with Docker",
    "url": "http://localhost:2368/deploying-your-node-app-with-docker/",
    "datePublished": "2015-11-16T23:22:34.344Z",
    "dateModified": "2015-11-16T23:29:44.370Z",
    "description": "Setting up your Docker image locally Download/Install Docker Tools https://www.docker.com/docker-toolbox Boot docker machine Run Docker Quickstart Terminal This will start up a docker-machine (virtual machine) on your local computer Once the docker machine is running,..."
}
    </script>

    <meta name="generator" content="Ghost 0.7">
    <link rel="alternate" type="application/rss+xml" title="" href="../rss/index.html">
</head>
<body class="post-template nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="index.html#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
            <li class="nav-home" role="presentation"><a href="../">Home</a></li>
    </ul>
    <a class="subscribe-button icon-feed" href="../rss/index.rss">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        


<header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        <a class="blog-logo" href="../"><img src="../content/images/2015/10/logo.png" alt=""></a>
            <a class="menu-button icon-menu" href="index.html#"><span class="word">Menu</span></a>
    </nav>
</header>

<main class="content" role="main">
    <article class="post">

        <header class="post-header">
            <h1 class="post-title">Deploying your node app with Docker</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2015-11-16">16 November 2015</time> 
            </section>
        </header>

        <section class="post-content">
            <h1 id="settingupyourdockerimagelocally">Setting up your Docker image locally</h1>

<h5 id="downloadinstalldockertools">Download/Install Docker Tools</h5>

<ul>
<li><a href="https://www.docker.com/docker-toolbox">https://www.docker.com/docker-toolbox</a></li>
</ul>

<h5 id="bootdockermachine">Boot docker machine</h5>

<ul>
<li>Run Docker Quickstart Terminal</li>
<li>This will start up a docker-machine (virtual machine) on your local computer</li>
<li>Once the docker machine is running, you should see the following logo pop up in your console
<img src="../content/images/2015/11/startDockerMachine.png" alt=""></li>
</ul>

<h5 id="checktoseeyourvmisrunning">Check to see your vm is running</h5>

<ul>
<li><p>Run command</p>

<blockquote>
  <p>docker-machine ls</p>
</blockquote></li>
<li><p>You should have the default virtual machine running.</p></li>
<li>This will be the machine that will host your docker containers</li>
</ul>

<p><img src="../content/images/2015/11/dockermachine.png" alt=""></p>

<h5 id="creatingadockerfile">Creating a Dockerfile</h5>

<ul>
<li>Navigate to the folder with your node application in the terminal</li>
<li>Create a file named Dockerfile in the root directory of your application</li>
<li>The docker file will contain instructions for docker to create a docker image</li>
</ul>

<pre><code># CONTENTS OF DOCKERFILE

# Defining the parent image to use build our image from.
FROM node:5

# bundle app’s source code inside the Docker image
COPY . /src

# move into the src directory where all the source code files live. install all npm dependencies
RUN cd /src; npm install

#map port 8000 to the docker daemon.
#REMEMBER TO CHANGE THIS IF THE PORT IS CHANGED IN server.js
EXPOSE 8000

# define the command line code that will start up the server
CMD ["node", "/src/server/server.js"]  
</code></pre>

<h5 id="whatisadockerimage">What is a docker image?</h5>

<ul>
<li>Docker images will contain all of your application code, and installed module dependencies</li>
</ul>

<h5 id="whatisthedockerfiledoing">What is the Dockerfile doing?</h5>

<ul>
<li>Declaring a base docker image as a starting point</li>
<li>Bundling your application code into a specified folder</li>
<li>Installing all npm modules in your package.json file</li>
<li>Establishing the port inside of your docker image that your code will be running on</li>
<li>Starting up the node server. In this case, my server starts by running the server.js file</li>
</ul>

<h5 id="creatingadockerignorefile">Creating a .dockerignore file</h5>

<ul>
<li>Similar to a .gitignore file for Github.</li>
<li>Will not load the files you have listed into your docker image.</li>
</ul>

<pre><code class="language-`"># CONTENTS OF .DOCKERIGNORE

node_modules/  
bower_components/  
*.log

build/  
dist/  
</code></pre>

<h5 id="buildingadockerimage">Building a docker image</h5>

<ul>
<li>Run command


<blockquote>
  <p>docker build -t [username]/[image_name]:[tagname] .</p></blockquote></li>
  </ul>
  Make sure that you:


<ul>
<li>use the same username that you have on docker hub</li>
<li>are located in your root directory for your web app</li>
<li>have a period at the end of the command</li>
</ul>

<p>What's happening?</p>

<ul>
<li>Docker is executing the contents of your docker file and creating your new image</li>
<li>Upon completion, run the command


<blockquote>
  <p>docker images</p></blockquote></li>
  </ul>
  <img src="../content/images/2015/11/images.png" alt="">


<ul>
<li>You should see the new image that you created in the list</li>
</ul>

<h5 id="runningyourdockerimageinadockercontainer">Running your docker image in a docker container</h5>

<ul>
<li>Run command


<blockquote>
  docker run -d -p [external<em>port]:[internal</em>port]  [username]/[image_name]:[tagname]</blockquote></li>
  </ul>
  <h6 id="commanddefinitions">Command definitions</h6>


<ul>
<li>external_port
<ul><li>port that will be used on the docker machine / server to access your docker container</li></ul></li>
<li>internal_port
*port that you have set your express application to listen on</li>
<li>username
<ul><li>your docker hub username</li></ul></li>
<li>image_name
<ul><li>The name of your image</li>
<li>Can be found in the repository column when running the docker ps command</li></ul></li>
<li>tag
<ul><li>used for versioning of your application</li>
<li>Can be found in the tag column when running the docker ps command</li></ul></li>
</ul>

<h6 id="runthecommand">Run the command</h6>

<blockquote>
  <p>docker ps</p>
</blockquote>

<p><img src="../content/images/2015/11/containers.png" alt=""></p>

<p>You should see your application in a docker container running</p>

<p>If your DO NOT see your application on the list, don’t panic.</p>

<ul>
<li>Run the command docker ps -a</li>
<li>This will show all of the processes that have previously run</li>
<li>If you see your image in here but not with the command docker ps, it means that either
<ul><li>The configuration for your docker file may not have set to run your application on boot</li>
<li>There was an error when attempting to execute your application</li></ul></li>
</ul>

<h5 id="viewingcontainerlogs">Viewing Container Logs</h5>

<p>If you need to view the logs for a container at any time, you can execute the command </p>

<blockquote>
  <p>docker [container_id] logs</p>
</blockquote>

<p>These logs have help you to debug why your container is no longer running or is running improperly. It can also help you to confirm that certain operations are running smoothly.</p>

<h5 id="accessingyourapplication">Accessing your Application</h5>

<p>Once your container is running, you can access your application in your browser by simply navigating to your server ip address @ the port that you set upon running. eg. 123.456.678.912:80</p>

<ul>
<li><p>You can find the ip address of your docker-machine by running the command</p>

<blockquote>
  <p>docker-machine ls</p>
</blockquote></li>
<li><p>Make sure that you select the host url, and ignore the port in the URL field and the tcp prefix</p></li>
<li><p>Append the port of your application container onto the host ip address</p>

<ul><li>In this case I set it to 80, so that no additional port needs to be declared</li></ul></li>
<li>If everything went well, you should be able to see it in your browser</li>
<li>If not, check out your docker logs with the command


<blockquote>
  docker <container_id> logs</container_id></blockquote></li>
  </ul>
  <h5 id="publishingdockerimagetodockerhub">Publishing docker image to docker hub</h5>


Once you have confirmed that your application is running as expected in the docker container on your local machine you are ready to publish your docker image onto docker hub.

<ul>
<li><p>Run command</p>

<blockquote>
  <p>docker login</p>
</blockquote></li>
<li><p>Sign in, if you have not already done so</p></li>
<li><p>Run command</p>

<blockquote>
  <p>docker push [username]/[docker_image_id] : [optional_tagname]</p>
</blockquote></li>
</ul>

<h1 id="deployingtoserver">Deploying to server</h1>

<h5 id="digitalocean">Digital Ocean</h5>

<p><a href="https://www.digitalocean.com/?refcode=80cd687d7427">https://www.digitalocean.com/?refcode=80cd687d7427</a></p>

<ul>
<li>Sign up for a free account with $10 credit.
<ul><li>This will let you host your docker instance for free for at least 2 months, but more like 3 or 4 with average dev usage.</li></ul></li>
<li>A credit card is required to sign up, but charges will NOT be made unless you pass the $10 of usage.
<ul><li>My site has been up for 2 days, and I’ve only been charged $0.02 so far</li></ul></li>
<li><p>After signing up, click create a droplet
<img src="../content/images/2015/11/createdrop.png" alt=""></p></li>
<li><p>Give your app a name, and select the lowest tier to start
<img src="../content/images/2015/11/hostname.png" alt=""></p></li>
<li><p>Select the region closest to you</p></li>
</ul>

<p><img src="../content/images/2015/11/region.png" alt=""></p>

<ul>
<li>Select the docker image on the bottom left</li>
</ul>

<p><img src="../content/images/2015/11/imagetype.png" alt=""></p>

<ul>
<li>Skip to the bottom, and set your SSH key to your device if you would like.
<ul><li>Else a password will be sent to you</li></ul></li>
</ul>

<p><img src="../content/images/2015/11/ssh.png" alt=""></p>

<ul>
<li>Wait for digital ocean to provision your droplet</li>
</ul>

<p><img src="../content/images/2015/11/creating.png" alt=""></p>

<ul>
<li><p>Once your droplet is created, you can access the console via the console provided on the digital ocean site, or by running an ssh command from your local console</p>

<ul><li>I would suggest logging in from your console on your local machine</li></ul></li>
<li><p>Run the command</p>

<blockquote>
  <p>ssh root@[server_ip_address]</p>
</blockquote></li>
<li><p>the server ip address can be found on your droplets dashboard page, directly under the name of your app</p></li>
</ul>

<p><img src="../content/images/2015/11/ip.png" alt=""></p>

<ul>
<li><p>Upon first login, you will be prompted to login with the credentials that were provided to you via an email from digital ocean when you spun up your droplet.</p></li>
<li><p>Once logged in, you will be prompted to change your root password. </p></li>
<li><p>run the commands</p>

<blockquote>
  <p>docker images</p>
  
  <p>docker ps</p>
</blockquote></li>
</ul>

<p>Both commands should have showed up as empty, confirming that you have a fresh image with docker running</p>

<ul>
<li><p>To pull down your docker image from your docker hub, and get it up and running on your server, run the same command</p>

<blockquote>
  <p>docker run -d -p 80:8000 [username]/[image_name] : [optional_tag]</p>
</blockquote></li>
<li><p>after executing docker run, check to see that your image was downloaded, and is currently running in a docker container by executing the command</p>

<blockquote>
  <p>docker ps</p>
</blockquote></li>
<li><p>Just like on your local machine, you should see your image running in a container if all went well</p></li>
<li><p>If you don't see it, then run</p>

<blockquote>
  <p>docker ps -a</p>
</blockquote></li>
</ul>

<p>to confirm that it attempted to run, and</p>

<blockquote>
  <p>docker logs [container_id]</p>
</blockquote>

<p>to view the log and track down the error if one exists</p>

<ul>
<li>Once your container is running, you can access your application in your browser by simply navigating to your server ip address @ the port that you set upon running.
<ul><li>eg. 123.456.678.912:80</li>
<li>In this case I set it to 80, so that no additional port needs to be declared</li></ul></li>
</ul>

<div class="footnotes"><ol><li class="footnote" id="fn:1"><p>For additional documentation, please refer to the following links: <a href="index.html#fnref:1" title="return to article">↩</a></p></li>
<li class="footnote" id="fn:2"><p><a href="http://docs.docker.com/engine/userguide/dockerimages/">http://docs.docker.com/engine/userguide/dockerimages/</a> <a href="index.html#fnref:2" title="return to article">↩</a></p></li>
<li class="footnote" id="fn:3"><p><a href="http://docs.docker.com/engine/examples/nodejs_web_app/">http://docs.docker.com/engine/examples/nodejs_web_app/</a> <a href="index.html#fnref:3" title="return to article">↩</a></p></li>
<li class="footnote" id="fn:4"><p><a href="https://www.digitalocean.com/community/tutorials/how-to-create-your-first-digitalocean-droplet-virtual-server">https://www.digitalocean.com/community/tutorials/how-to-create-your-first-digitalocean-droplet-virtual-server</a> <a href="index.html#fnref:4" title="return to article">↩</a></p></li></ol></div>
        </section>

        <footer class="post-footer">


            <figure class="author-image">
                <a class="img" href="../author/nickfujita/" style="background-image: url(../content/images/2015/10/nickFujitaGenericProfilePic.jpg)"><span class="hidden">nick fujita's Picture</span></a>
            </figure>

            <section class="author">
                <h4><a href="../author/nickfujita/">nick fujita</a></h4>

                    <p>Read <a href="../author/nickfujita/">more posts</a> by this author.</p>
                <div class="author-meta">
                    
                    
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/intent/tweet?text=Deploying%20your%20node%20app%20with%20Docker&amp;url=http://localhost:2368/deploying-your-node-app-with-docker/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:2368/deploying-your-node-app-with-docker/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://localhost:2368/deploying-your-node-app-with-docker/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>

    </article>
</main>

<aside class="read-next">
</aside>



        <footer class="site-footer clearfix">
            <section class="copyright"><a href="../"></a> © 2015</section>
            <section class="poweredby">Proudly published with <a href="https://ghost.org">Ghost</a></section>
        </footer>

    </div>

    

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="../assets/js/jquery.fitvids.js?v=ec6d317db7"></script>
    <script type="text/javascript" src="../assets/js/index.js?v=ec6d317db7"></script>

</body>
